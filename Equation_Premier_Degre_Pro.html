<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="R√©solveur d'√©quations du premier degr√© (ax+b = cx+d) avec une r√©daction p√©dagogique √©tape par √©tape." />
  <meta name="color-scheme" content="light dark" />
  <title>√âquation Pro | R√©solveur du Premier Degr√©</title>
  <style>
    :root {
      --radius: 14px;
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --primary: #1976d2; /* Blue theme */
      --primary-dark: #1565c0;
      --transition: all 0.2s ease;
      --focus-glow: 0 0 0 3px rgba(25, 118, 210, 0.3);
      --comment-color: #9aa2af;
      --op-color: #ef5350; /* Red for operations */
    }
    body.theme-dark {
      --bg: #0f1115; --card: #161a22; --text: #e8ecf1; --muted: #9aa2af;
      --border: #232939; --input-bg: #0d1117; --placeholder: #5c6370;
      --accent: rgba(25, 118, 210, 0.15);
    }
    body.theme-light {
      --bg: #f6f8fc; --card: #ffffff; --text: #10141a; --muted: #586171;
      --border: #e5e9f1; --input-bg: #fefefe; --placeholder: #8a94a6;
      --accent: rgba(25, 118, 210, 0.08); --comment-color: #586171;
    }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.5; transition: var(--transition);
    }
    h1, h2, h3 { font-weight: 600; margin: 0; }

    .topbar {
      position: sticky; top: 0; z-index: 3; background: var(--card);
      border-bottom: 1px solid var(--border); padding: 12px 16px;
      display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .icon-btn, .btn {
      border: 1px solid var(--border); background: transparent; color: var(--text);
      border-radius: 10px; font-weight: 500; touch-action: manipulation;
      transition: var(--transition); cursor: pointer;
    }
    .icon-btn { padding: 8px 10px; font-size: 16px; display: inline-flex; align-items: center; justify-content: center; }
    .btn { padding: 10px 16px; font-size: 14px; }
    .btn:hover, .icon-btn:hover { background: var(--accent); border-color: rgba(25, 118, 210, 0.24); }
    .btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
    .btn[disabled] { opacity: 0.5; cursor: not-allowed; background: var(--accent); border-color: transparent; }

    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 16px; margin: 16px 0; animation: fadeIn 0.3s ease-out;
    }
    .card h2 { font-size: 18px; margin-bottom: 12px; }

    input[type="text"] {
      background: var(--input-bg); color: var(--text); border: 1px solid var(--border);
      border-radius: 8px; padding: 10px 12px; font-size: 16px; transition: var(--transition);
      width: 60px; text-align: center;
    }
    input:focus { outline: none; border-color: var(--primary); box-shadow: var(--focus-glow); }
    
    .equation-container {
        display: flex; align-items: center; justify-content: center;
        gap: 10px; flex-wrap: wrap; font-size: 20px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    .equation-side { display: flex; align-items: center; gap: 10px; }
    
    #liveEquation {
        font-size: 22px; text-align: center; color: var(--primary); font-weight: 500;
        padding: 12px; background: var(--accent); border-radius: 10px; margin-top: 20px;
        word-break: break-all;
        min-height: 1.5em; /* Ensures the box is always visible */
    }

    pre {
      white-space: pre-wrap; margin: 0; background: var(--input-bg);
      border: 1px solid var(--border); border-radius: 10px; padding: 14px;
      font: 16px/1.8 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    .comment { color: var(--comment-color); }
    .op-highlight { color: var(--op-color); }
    .msg { margin-top: 12px; font-size: 13px; }
    .msg.error { color: #ff6b6b; } .msg.success { color: #4caf50; }

    dialog {
      border: 1px solid var(--border); background: var(--card); color: var(--text);
      border-radius: var(--radius); padding: 16px; max-width: 720px; 
      width: calc(100% - 32px); box-shadow: var(--shadow);
    }
    dialog::backdrop { background: rgba(0,0,0,0.4); }
    .dialog-actions { margin-top: 12px; display: flex; justify-content: flex-end; gap: 8px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    @keyframes dialog-show {
      from { opacity: 0; transform: scale(0.97) translateY(10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    dialog[open] { animation: dialog-show 0.3s ease-out forwards; }

    @keyframes backdrop-fade-in {
      from { background: rgba(0, 0, 0, 0); }
      to { background: rgba(0, 0, 0, 0.5); }
    }
    dialog[open]::backdrop { animation: backdrop-fade-in 0.3s ease-out forwards; }

    .dropdown { position: relative; }
    .dropdown-summary { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 600; cursor: pointer; list-style: none; padding: 4px 8px; border-radius: 8px; transition: var(--transition); }
    .dropdown-summary:hover { background: var(--accent); }
    .dropdown-summary::-webkit-details-marker { display: none; }
    .dropdown-summary .arrow { transition: transform 0.2s ease; }
    details[open] > .dropdown-summary .arrow { transform: rotate(180deg); }
    .dropdown-menu { position: absolute; top: calc(100% + 8px); left: 0; z-index: 10; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); width: 280px; padding: 8px; opacity: 0; transform: translateY(-10px); pointer-events: none; transition: opacity 0.2s ease, transform 0.2s ease; }
    details[open] > .dropdown-menu { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .dropdown-menu a { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; text-decoration: none; color: var(--text); font-size: 14px; font-weight: 500; }
    .dropdown-menu a:hover { background: var(--accent); }
    .dropdown-menu a.active { font-weight: 600; color: var(--primary); background: var(--accent); }
    .dropdown-menu .emoji { font-size: 18px; }
    .dropdown-menu hr { border: none; border-top: 1px solid var(--border); margin: 8px 0; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="theme-dark">
  <header class="topbar">
    <details class="dropdown">
      <summary class="dropdown-summary">
        <span class="emoji">‚öñÔ∏è</span>
        <span>√âquation Pro</span>
        <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M7 10l5 5 5-5H7z"></path></svg>
      </summary>
      <nav class="dropdown-menu">
        <a href="index.html"><span class="emoji">üî¢</span><span>Menu Principal</span></a>
        <hr>
        <a href="Pythagore_pro.html"><span class="emoji">üßÆ</span><span>Pythagore Pro</span></a>
        <a href="Thales_Pro.html"><span class="emoji">üìê</span><span>Thal√®s Pro</span></a>
        <a href="Developpement_Pro.html"><span class="emoji">‚öôÔ∏è</span><span>D√©veloppement Pro</span></a>
        <a href="Equation_Premier_Degre_Pro.html" class="active"><span class="emoji">‚öñÔ∏è</span><span>√âquation Pro (1er degr√©)</span></a>
        <a href="Statistique_Pro.html"><span class="emoji">üìä</span><span>Statistique Pro</span></a>
      </nav>
    </details>
    <div class="actions">
      <button id="btnTheme" class="icon-btn" title="Changer de th√®me">üåì</button>
      <button id="btnInfo" class="icon-btn" title="Aide">‚ÑπÔ∏è</button>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="section-calc">
      <h2 id="section-calc">Entrez l'√©quation √† r√©soudre :</h2>
      <div class="equation-container">
        <div class="equation-side">
          <input id="inputA" type="text" placeholder="a" aria-label="Coefficient a"> <span>x +</span>
          <input id="inputB" type="text" placeholder="b" aria-label="Coefficient b">
        </div>
        <span>=</span>
        <div class="equation-side">
          <input id="inputC" type="text" placeholder="c" aria-label="Coefficient c"> <span>x +</span>
          <input id="inputD" type="text" placeholder="d" aria-label="Coefficient d">
        </div>
      </div>
      <div id="liveEquation"></div>
    </section>

    <section class="card">
      <div class="actions">
        <button id="btnSolve" class="btn primary" disabled>R√©soudre</button>
        <button id="btnClear" class="btn">Effacer</button>
      </div>
      <div id="msg" class="msg" role="status" aria-live="polite"></div>
    </section>

    <section id="resultCard" class="card" hidden>
      <pre id="resultSteps"></pre>
      <div class="actions" style="margin-top:10px; gap: 8px;">
        <button id="btnCopy" class="btn">Copier la r√©daction</button>
        <button id="btnNew" class="btn">Nouveau</button>
        <button id="btnExportPDF" class="btn">Exporter en PDF</button>
      </div>
    </section>
  </main>

  <dialog id="dlgHelp">
    <h3>Aide ‚Ä¢ √âquation Pro</h3>
    <p>Cet outil r√©sout les √©quations du premier degr√© de la forme ax + b = cx + d.</p>
    <ul>
      <li><strong>Entrez les coefficients :</strong> Remplissez les quatre champs a, b, c et d. Vous pouvez utiliser des nombres entiers, d√©cimaux, positifs ou n√©gatifs.</li>
      <li><strong>Pr√©visualisez :</strong> L'√©quation se met √† jour en temps r√©el en dessous des champs de saisie.</li>
      <li><strong>R√©solvez :</strong> Le bouton "R√©soudre" devient actif lorsque tous les coefficients sont valides. Cliquez pour obtenir la r√©daction compl√®te et d√©taill√©e.</li>
    </ul>
    <div class="dialog-actions">
      <button id="btnHelpClose" class="btn">Fermer</button>
    </div>
  </dialog>

  <script>
    (function () {
      'use strict';
      
      const LS_THEME = 'equation_1deg_theme_v3';
      const el = {};

      function byId(id) { return document.getElementById(id); }

      function setupElements() {
          const ids = ['inputA', 'inputB', 'inputC', 'inputD', 'liveEquation', 'btnSolve', 
                       'btnClear', 'btnCopy', 'msg', 'resultCard', 'resultSteps', 'btnTheme',
                       'btnNew', 'btnExportPDF', 'btnInfo', 'dlgHelp', 'btnHelpClose'];
          ids.forEach(id => el[id] = byId(id));
      }

      const format = {
          num: n => n.toLocaleString('fr-FR', {maximumFractionDigits: 4}),
          parenthesis: n => n < 0 ? `(${format.num(n)})` : format.num(n),
          term: (coeff, variable = '') => {
              if (coeff === 0 && variable) return '';
              if (coeff === 0 && !variable) return '0';
              if (Math.abs(coeff) === 1 && variable) return coeff > 0 ? variable : `-${variable}`;
              return `${format.num(coeff)}${variable}`;
          },
          op: (n, isX = false) => {
              const sign = n < 0 ? '-' : '+';
              let val = format.num(Math.abs(n));
              if (isX && Math.abs(n) === 1) val = '';
              return ` ${sign} ${val}${isX ? 'x' : ''}`;
          },
          parenthesisTerm: (coeff, variable = '') => {
              const termStr = format.term(coeff, variable);
              return coeff < 0 ? `(${termStr})` : termStr;
          }
      };

      function parseInput(id) {
          const val = el[id]?.value.trim().replace(',', '.');
          if (val === '' || val ==='-') return NaN;
          const num = parseFloat(val);
          return isFinite(num) ? num : NaN;
      }
      
      function getInputs() {
          return {
              a: parseInput('inputA'), b: parseInput('inputB'),
              c: parseInput('inputC'), d: parseInput('inputD')
          };
      }

      function buildExpr(coeffX, constTerm, coeffXName = 'a', constTermName = 'b') {
          let parts = [];
          if (!isNaN(coeffX)) {
              if(coeffX !== 0) parts.push(format.term(coeffX, 'x'));
          } else { parts.push(coeffXName + 'x'); }
          
          if (!isNaN(constTerm)) {
              if (constTerm !== 0) {
                  if (parts.length > 0) parts.push(constTerm > 0 ? '+' : '-');
                  else if (constTerm < 0) parts.push('-');
                  parts.push(format.num(Math.abs(constTerm)));
              }
          } else {
              if (parts.length > 0) parts.push('+');
              parts.push(constTermName);
          }
          let expr = parts.length > 0 ? parts.join(' ').replace(/\+ -/g, '-') : '0';
          return expr.replace(/ \+ /g, ' + ').replace(/ - /g, ' - ');
      }

      function updateLiveUI() {
          const v = getInputs();
          el.btnSolve.disabled = Object.values(v).some(isNaN);
          
          el.liveEquation.textContent = `${buildExpr(v.a, v.b, 'a', 'b')} = ${buildExpr(v.c, v.d, 'c', 'd')}`;
      }

      function showMsg(message, type = 'info') {
        el.msg.textContent = message;
        el.msg.className = `msg ${type || 'info'}`;
      }

      function solveEquation(v) {
          let { a, b, c, d } = v;
          let steps = [`${buildExpr(a,b)} = ${buildExpr(c,d)}\n`];
          let stepCounter = 1;

          if (b !== 0) {
              steps.push(`<span class="comment">‚Ä¢ √âtape ${stepCounter++} : On isole les constantes √† droite</span>`);
              const opStr = `<span class="op-highlight">${format.op(-b)}</span>`;
              steps.push(`${buildExpr(a,b)} ${opStr} = ${buildExpr(c,d)} ${opStr}`);
              d -= b;
              b = 0;
              steps.push(`${buildExpr(a,b)} = ${buildExpr(c,d)}\n`);
          }
          
          if (c !== 0) {
              steps.push(`<span class="comment">‚Ä¢ √âtape ${stepCounter++} : On isole les inconnues √† gauche</span>`);
              const opStr = `<span class="op-highlight">${format.op(-c, true)}</span>`;
              steps.push(`${buildExpr(a,b)} ${opStr} = ${buildExpr(c,d)} ${opStr}`);
              a -= c;
              c = 0;
              steps.push(`${buildExpr(a,b)} = ${buildExpr(c,d)}\n`);
          }
          
          if (a !== 0) {
              const x = d / a;
              steps.push(`<span class="comment">‚Ä¢ √âtape ${stepCounter++} : On divise les deux membres par ${format.num(a)}</span>`);
              steps.push(`${format.parenthesisTerm(a,'x')} √∑ ${format.parenthesis(a)} = ${format.parenthesisTerm(d)} √∑ ${format.parenthesis(a)}`);
              steps.push(`x = ${format.num(x)}`);
              steps.push(`\n<strong>Conclusion : la valeur de x est ${format.num(x)}.</strong>`);
          } else { 
              if (d === 0) { 
                  steps.push(`\n<span class="comment">‚Ä¢ L'√©quation 0 = 0 est toujours vraie.</span>`);
                  steps.push(`<strong>Conclusion : Tout nombre r√©el est solution, S = ‚Ñù.</strong>`);
              } else { 
                  steps.push(`\n<span class="comment">‚Ä¢ L'√©quation ${buildExpr(c,d)} = 0 est impossible.</span>`);
                  steps.push(`<strong>Conclusion : Il n'y a aucune solution, S = ‚àÖ.</strong>`);
              }
          }
          return steps.join('\n');
      }

      function handleSolve() {
          el.resultCard.hidden = true;
          try {
              const values = getInputs();
              const steps = solveEquation(values);
              el.resultSteps.innerHTML = steps; 
              el.resultCard.hidden = false;
              showMsg('R√©solution termin√©e.', 'success');
          } catch (e) {
              showMsg('Une erreur est survenue.', 'error');
          }
      }

      function setupEventListeners() {
          el.btnSolve.addEventListener('click', handleSolve);
          ['inputA', 'inputB', 'inputC', 'inputD'].forEach(id => {
              el[id].addEventListener('input', () => { el.resultCard.hidden = true; updateLiveUI(); });
              el[id].addEventListener('keypress', (e) => { if (e.key === 'Enter' && !el.btnSolve.disabled) { e.preventDefault(); handleSolve(); }});
          });
          
          const clearAction = () => {
              ['inputA', 'inputB', 'inputC', 'inputD'].forEach(id => el[id].value = '');
              el.resultCard.hidden = true;
              showMsg('Champs effac√©s.');
              updateLiveUI();
          };
          el.btnClear.addEventListener('click', clearAction);
          el.btnNew.addEventListener('click', clearAction);

          el.btnCopy.textContent = "Copier la r√©daction";
          el.btnCopy.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              navigator.clipboard.writeText(el.resultSteps.innerText)
                  .then(() => showMsg('R√©daction copi√©e.', 'success'));
          });

          el.btnExportPDF.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const title = `R√©solution de: ${el.liveEquation.textContent}`;
                const content = el.resultSteps.innerText;

                doc.setFont('Helvetica', 'bold');
                doc.text(title, 10, 15);

                doc.setFont('Courier', 'normal');
                const splitContent = doc.splitTextToSize(content, 180);
                doc.text(splitContent, 10, 25);
                
                doc.save('Equation_Pro_Redaction.pdf');
                showMsg('Export PDF g√©n√©r√©.', 'success');
              } catch (e) {
                showMsg('Erreur lors de la g√©n√©ration du PDF.', 'error');
                console.error(e);
              }
          });

          el.btnTheme.addEventListener('click', () => {
              const newTheme = document.body.classList.contains('theme-dark') ? 'theme-light' : 'theme-dark';
              document.body.className = newTheme;
              localStorage.setItem(LS_THEME, newTheme);
              el.btnTheme.textContent = newTheme === 'theme-dark' ? '‚òÄÔ∏è' : 'üåô';
          });

          el.btnInfo.addEventListener('click', () => el.dlgHelp.showModal());
          el.btnHelpClose.addEventListener('click', () => el.dlgHelp.close());
      }
      
      document.addEventListener('DOMContentLoaded', () => {
          setupElements();
          const savedTheme = localStorage.getItem(LS_THEME) || 'theme-dark';
          document.body.className = savedTheme;
          el.btnTheme.textContent = savedTheme === 'theme-dark' ? '‚òÄÔ∏è' : 'üåô';
          setupEventListeners();
          updateLiveUI();
      });
    })();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Outil de factorisation avec rÃ©daction dÃ©taillÃ©e (IdentitÃ©s remarquables et facteur commun)." />
  <meta name="color-scheme" content="light dark" />
  <title>Factorisation Pro | AlgÃ¨bre</title>
  <style>
    :root {
      --radius: 14px;
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --primary: #1976d2;
      --primary-dark: #1565c0;
      --transition: all 0.2s ease;
      --focus-glow: 0 0 0 3px rgba(25, 118, 210, 0.3);
      --accent: rgba(25, 118, 210, 0.15);
    }
    body.theme-dark {
      --bg: #0f1115; --card: #161a22; --text: #e8ecf1; --muted: #9aa2af;
      --border: #232939; --input-bg: #0d1117; --placeholder: #5c6370;
      --accent: rgba(25, 118, 210, 0.15);
    }
    body.theme-light {
      --bg: #f6f8fc; --card: #ffffff; --text: #10141a; --muted: #586171;
      --border: #e5e9f1; --input-bg: #fefefe; --placeholder: #8a94a6;
      --accent: rgba(25, 118, 210, 0.08);
    }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.5; transition: var(--transition);
    }
    h1, h2, h3 { font-weight: 600; margin: 0; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .topbar {
      position: sticky; top: 0; z-index: 3; background: var(--card);
      border-bottom: 1px solid var(--border); padding: 12px 16px;
      display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .icon-btn, .btn {
      border: 1px solid var(--border); background: transparent; color: var(--text);
      border-radius: 10px; font-weight: 500; touch-action: manipulation;
      transition: var(--transition); cursor: pointer;
    }
    .icon-btn { padding: 8px 10px; font-size: 16px; display: inline-flex; align-items: center; justify-content: center; }
    .btn { padding: 10px 16px; font-size: 14px; }
    .btn:hover, .icon-btn:hover { background: var(--accent); border-color: rgba(25, 118, 210, 0.24); }
    .btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
    .btn[disabled] { opacity: 0.5; cursor: not-allowed; background: var(--accent); border-color: transparent; }

    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 16px; margin: 16px 0; animation: fadeIn 0.3s ease-out;
    }
    .card h2 { font-size: 18px; margin-bottom: 12px; }

    input[type="text"], select {
      background: var(--input-bg); color: var(--text);
      border: 1px solid var(--border); border-radius: 8px;
      padding: 10px 12px; font-size: 14px; transition: var(--transition);
    }
    input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: var(--focus-glow); }
    input[type="text"] { max-width: 120px; text-align: center; }
    
    .input-group { display: flex; flex-direction: column; gap: 20px; margin-top: 20px; }
    
    /* Centrage et placement des inputs */
    .input-row {
        display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 12px;
        font-size: 18px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    
    .input-row span {
        font-weight: 600;
        color: var(--primary);
    }

    /* PrÃ©visualisation */
    #liveExpression {
        font-size: 22px; text-align: center; color: var(--primary);
        font-weight: 500; padding: 16px; background: var(--accent);
        border-radius: 10px; margin-top: 24px; transition: var(--transition);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
        word-break: break-all;
        min-height: 1.5em;
        display: none; /* CachÃ© par dÃ©faut si vide */
    }

    pre {
      white-space: pre-wrap; margin: 0; background: var(--input-bg);
      border: 1px solid var(--border); border-radius: 10px; padding: 16px;
      font: 14px/1.7 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }

    .msg { margin-top: 12px; font-size: 13px; }
    .msg.error { color: #ff6b6b; } .msg.success { color: #4caf50; }

    /* Dialogs */
    dialog {
      border: 1px solid var(--border); background: var(--card); color: var(--text);
      border-radius: var(--radius); padding: 16px; max-width: 720px; 
      width: calc(100% - 32px); box-shadow: var(--shadow);
    }
    dialog::backdrop { background: rgba(0,0,0,0.4); }
    .dialog-actions { margin-top: 12px; display: flex; justify-content: flex-end; gap: 8px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes dialog-show { from { opacity: 0; transform: scale(0.97) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
    dialog[open] { animation: dialog-show 0.3s ease-out forwards; }
    @keyframes backdrop-fade-in { from { background: rgba(0, 0, 0, 0); } to { background: rgba(0, 0, 0, 0.4); } }
    dialog[open]::backdrop { animation: backdrop-fade-in 0.3s ease-out forwards; }

    /* Menu Dropdown */
    .dropdown { position: relative; }
    .dropdown-summary { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 600; cursor: pointer; list-style: none; padding: 4px 8px; border-radius: 8px; transition: var(--transition); }
    .dropdown-summary:hover { background: var(--accent); }
    .dropdown-summary::-webkit-details-marker { display: none; }
    .dropdown-summary .arrow { transition: transform 0.2s ease; }
    details[open] > .dropdown-summary .arrow { transform: rotate(180deg); }
    .dropdown-menu { position: absolute; top: calc(100% + 8px); left: 0; z-index: 10; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); width: 280px; padding: 8px; opacity: 0; transform: translateY(-10px); pointer-events: none; transition: opacity 0.2s ease, transform 0.2s ease; }
    details[open] > .dropdown-menu { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .dropdown-menu a { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; text-decoration: none; color: var(--text); font-size: 14px; font-weight: 500; }
    .dropdown-menu a:hover { background: var(--accent); }
    .dropdown-menu a.active { font-weight: 600; color: var(--primary); background: var(--accent); }
    .dropdown-menu .emoji { font-size: 18px; }
    .dropdown-menu hr { border: none; border-top: 1px solid var(--border); margin: 8px 0; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="theme-dark">
  <header class="topbar">
    <details class="dropdown">
      <summary class="dropdown-summary">
        <span class="emoji">ğŸ§©</span>
        <span>Factorisation Pro</span>
        <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M7 10l5 5 5-5H7z"></path></svg>
      </summary>
      <nav class="dropdown-menu">
        <a href="index.html"><span class="emoji">ğŸ”¢</span><span>Menu Principal</span></a>
        <hr>
        <a href="Factorisation_Pro.html" class="active"><span class="emoji">ğŸ§©</span><span>Factorisation Pro</span></a>
        <a href="Developpement_Pro.html"><span class="emoji">âš™ï¸</span><span>DÃ©veloppement Pro</span></a>
        <a href="Pythagore_pro.html"><span class="emoji">ğŸ§®</span><span>Pythagore Pro</span></a>
        <a href="Thales_Pro.html"><span class="emoji">ğŸ“</span><span>ThalÃ¨s Pro</span></a>
        <a href="Equation_Premier_Degre_Pro.html"><span class="emoji">âš–ï¸</span><span>Ã‰quation Pro</span></a>
        <a href="Statistique_Pro.html"><span class="emoji">ğŸ“Š</span><span>Statistique Pro</span></a>
      </nav>
    </details>
    <div class="actions">
      <button id="btnTheme" class="icon-btn" title="Changer de thÃ¨me">ğŸŒ“</button>
      <button id="btnInfo" class="icon-btn" title="Aide">â„¹ï¸</button>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="section-calc">
      <h2 id="section-calc">Entrez les valeurs pour factoriser :</h2>

      <div class="field">
        <label for="modeSelect">MÃ©thode de factorisation</label>
        <select id="modeSelect">
          <option value="diff_squares">DiffÃ©rence de carrÃ©s : aÂ² - bÂ²</option>
          <option value="common_factor">Facteur commun : ka + kb</option>
          <option value="perfect_sq_plus">CarrÃ© parfait : aÂ² + 2ab + bÂ²</option>
          <option value="perfect_sq_minus">CarrÃ© parfait : aÂ² - 2ab + bÂ²</option>
        </select>
      </div>

      <div class="input-group">
        
        <!-- Inputs pour aÂ² - bÂ² et CarrÃ©s parfaits -->
        <div class="input-row" id="groupAB">
            <span>a =</span>
            <input id="inputA" type="text" value="" placeholder="ex: 37, x">
            <span>b =</span>
            <input id="inputB" type="text" value="" placeholder="ex: x, 5">
        </div>

        <!-- Inputs pour ka + kb -->
        <div class="input-row" id="groupCommon" style="display:none;">
            <span>k =</span>
            <input id="inputK" type="text" value="" placeholder="facteur">
            <span>a =</span>
            <input id="inputA_common" type="text" value="" placeholder="terme 1">
            <span>b =</span>
            <input id="inputB_common" type="text" value="" placeholder="terme 2">
        </div>

      </div>
      
      <div id="liveExpression"></div>
    </section>

    <section class="card">
      <div class="actions">
        <button id="btnFactor" class="btn primary" disabled>Factoriser</button>
        <button id="btnClear" class="btn">Effacer</button>
      </div>
      <div id="msg" class="msg" role="status" aria-live="polite"></div>
    </section>

    <section id="resultCard" class="card" hidden>
      <pre id="resultSteps"></pre>
      <div class="actions" style="margin-top:10px; gap: 8px;">
        <button id="btnCopyRedaction" class="btn">Copier la rÃ©daction</button>
        <button id="btnNew" class="btn">Nouveau</button>
        <button id="btnExportPDF" class="btn">Exporter en PDF</button>
      </div>
    </section>
  </main>

  <dialog id="dlgHelp">
    <h3 id="helpTitle">Aide â€¢ Factorisation Pro</h3>
    <p>Cet outil factorise des expressions algÃ©briques en utilisant les identitÃ©s remarquables ou le facteur commun, avec une rÃ©daction soignÃ©e.</p>
    <ul>
      <li><strong>DiffÃ©rence de carrÃ©s (aÂ² - bÂ²) :</strong> Entrez les termes 'a' et 'b' qui sont mis au carrÃ©. Exemple : pour 37Â² - xÂ², entrez a=37 et b=x.</li>
      <li><strong>Facteur commun (ka + kb) :</strong> Entrez le facteur commun 'k' et les termes restants.</li>
      <li><strong>CarrÃ©s parfaits :</strong> Entrez 'a' et 'b' pour obtenir la factorisation de la forme dÃ©veloppÃ©e.</li>
    </ul>
    <div class="dialog-actions">
      <button id="btnHelpClose" class="btn">Fermer</button>
    </div>
  </dialog>

  <script>
    (function () {
      'use strict';
      
      const LS_THEME = 'fact_theme_v1';
      const el = {};
      let state = { mode: 'diff_squares' };

      function byId(id) { return document.getElementById(id); }

      function setupElements() {
          const ids = [
              'modeSelect', 'inputA', 'inputB', 'inputK', 'inputA_common', 'inputB_common',
              'groupAB', 'groupCommon', 'liveExpression', 
              'btnFactor', 'btnClear', 'msg', 'resultCard', 'resultSteps', 
              'btnTheme', 'btnInfo', 'dlgHelp', 'btnHelpClose',
              'btnCopyRedaction', 'btnNew', 'btnExportPDF'
          ];
          ids.forEach(id => el[id] = byId(id));
      }

      function showMsg(message, type = 'info') {
        el.msg.textContent = message;
        el.msg.className = `msg ${type || 'info'}`;
      }

      // Formater les termes pour l'affichage
      const format = {
          termSq: (val) => {
              const isSimple = /^[0-9]+$/.test(val) || /^[a-zA-Z]$/.test(val);
              return isSimple ? `${val}Â²` : `(${val})Â²`;
          },
          term: (val) => val
      };

      function getInputs() {
          if (state.mode === 'common_factor') {
              return {
                  k: el.inputK.value.trim(),
                  a: el.inputA_common.value.trim(),
                  b: el.inputB_common.value.trim()
              };
          } else {
              return {
                  a: el.inputA.value.trim(),
                  b: el.inputB.value.trim()
              };
          }
      }

      function updateUIMode() {
          state.mode = el.modeSelect.value;
          const isCommon = state.mode === 'common_factor';
          
          el.groupAB.style.display = isCommon ? 'none' : 'flex';
          el.groupCommon.style.display = isCommon ? 'flex' : 'none';
          
          updateLiveUI();
          el.resultCard.hidden = true;
      }
      
      function updateLiveUI() {
          const v = getInputs();
          let expr = '';
          let isValid = false;

          if (state.mode === 'common_factor') {
              isValid = v.k && v.a && v.b;
              if (isValid) {
                  expr = `${v.k}Ã—${v.a} + ${v.k}Ã—${v.b}`;
              }
          } else {
              isValid = v.a && v.b;
              if (isValid) {
                  if (state.mode === 'diff_squares') {
                      expr = `${format.termSq(v.a)} - ${format.termSq(v.b)}`;
                  } else if (state.mode === 'perfect_sq_plus') {
                      expr = `${format.termSq(v.a)} + 2Ã—${v.a}Ã—${v.b} + ${format.termSq(v.b)}`;
                  } else if (state.mode === 'perfect_sq_minus') {
                      expr = `${format.termSq(v.a)} - 2Ã—${v.a}Ã—${v.b} + ${format.termSq(v.b)}`;
                  }
              }
          }

          if (expr) {
              el.liveExpression.textContent = expr;
              el.liveExpression.style.display = 'block';
          } else {
              el.liveExpression.textContent = '';
              el.liveExpression.style.display = 'none';
          }
          
          el.btnFactor.disabled = !isValid;
      }
      
      function generateSteps(v) {
          let steps = [];
          let expressionInitiale = "";
          let resultat = "";

          if (state.mode === 'diff_squares') {
              expressionInitiale = `${format.termSq(v.a)} - ${format.termSq(v.b)}`;
              resultat = `(${v.a} + ${v.b})(${v.a} - ${v.b})`;
              
              steps.push(`Factorisation de : ${expressionInitiale}`);
              steps.push(``);
              steps.push(`On souhaite mettre lâ€™expression ${expressionInitiale} sous forme factorisÃ©e.`);
              steps.push(``);
              steps.push(`On reconnaÃ®t une identitÃ© remarquable :`);
              steps.push(`aÂ² - bÂ² = (a + b)(a - b)`);
              steps.push(``);
              steps.push(`Dans notre cas :`);
              steps.push(`a = ${v.a}`);
              steps.push(`b = ${v.b}`);
              steps.push(``);
              steps.push(`On applique la formule :`);
              steps.push(`${expressionInitiale} = (${v.a} + ${v.b})(${v.a} - ${v.b})`);
              steps.push(``);
              steps.push(`Conclusion :`);
              steps.push(`La forme factorisÃ©e de ${expressionInitiale} est ${resultat}`);
          } 
          else if (state.mode === 'common_factor') {
              expressionInitiale = `${v.k}Ã—${v.a} + ${v.k}Ã—${v.b}`;
              resultat = `${v.k}(${v.a} + ${v.b})`;

              steps.push(`Factorisation de : ${expressionInitiale}`);
              steps.push(``);
              steps.push(`On souhaite mettre lâ€™expression sous forme factorisÃ©e.`);
              steps.push(``);
              steps.push(`On repÃ¨re un facteur commun :`);
              steps.push(`ka + kb = k(a + b)`);
              steps.push(``);
              steps.push(`Dans notre cas :`);
              steps.push(`k = ${v.k} (le facteur commun)`);
              steps.push(`a = ${v.a}`);
              steps.push(`b = ${v.b}`);
              steps.push(``);
              steps.push(`On applique la formule :`);
              steps.push(`${expressionInitiale} = ${v.k}(${v.a} + ${v.b})`);
              steps.push(``);
              steps.push(`Conclusion :`);
              steps.push(`La forme factorisÃ©e est ${resultat}`);
          }
          else if (state.mode === 'perfect_sq_plus') {
              expressionInitiale = `${format.termSq(v.a)} + 2Ã—${v.a}Ã—${v.b} + ${format.termSq(v.b)}`;
              resultat = `(${v.a} + ${v.b})Â²`;

              steps.push(`Factorisation de : ${expressionInitiale}`);
              steps.push(``);
              steps.push(`On souhaite mettre lâ€™expression sous forme factorisÃ©e.`);
              steps.push(``);
              steps.push(`On reconnaÃ®t l'identitÃ© remarquable :`);
              steps.push(`aÂ² + 2ab + bÂ² = (a + b)Â²`);
              steps.push(``);
              steps.push(`Dans notre cas :`);
              steps.push(`a = ${v.a}`);
              steps.push(`b = ${v.b}`);
              steps.push(``);
              steps.push(`On applique la formule :`);
              steps.push(`${expressionInitiale} = (${v.a} + ${v.b})Â²`);
              steps.push(``);
              steps.push(`Conclusion :`);
              steps.push(`La forme factorisÃ©e est ${resultat}`);
          }
          else if (state.mode === 'perfect_sq_minus') {
              expressionInitiale = `${format.termSq(v.a)} - 2Ã—${v.a}Ã—${v.b} + ${format.termSq(v.b)}`;
              resultat = `(${v.a} - ${v.b})Â²`;

              steps.push(`Factorisation de : ${expressionInitiale}`);
              steps.push(``);
              steps.push(`On souhaite mettre lâ€™expression sous forme factorisÃ©e.`);
              steps.push(``);
              steps.push(`On reconnaÃ®t l'identitÃ© remarquable :`);
              steps.push(`aÂ² - 2ab + bÂ² = (a - b)Â²`);
              steps.push(``);
              steps.push(`Dans notre cas :`);
              steps.push(`a = ${v.a}`);
              steps.push(`b = ${v.b}`);
              steps.push(``);
              steps.push(`On applique la formule :`);
              steps.push(`${expressionInitiale} = (${v.a} - ${v.b})Â²`);
              steps.push(``);
              steps.push(`Conclusion :`);
              steps.push(`La forme factorisÃ©e est ${resultat}`);
          }

          return steps.join('\n');
      }

      function handleFactorisation() {
          el.resultCard.hidden = true;
          try {
              const values = getInputs();
              const steps = generateSteps(values);
              el.resultSteps.textContent = steps;
              el.resultCard.hidden = false;
              showMsg('Factorisation rÃ©ussie.', 'success');
          } catch (e) {
              showMsg(e.message || 'Erreur inconnue.', 'error');
          }
      }

      function setupEventListeners() {
          el.modeSelect.addEventListener('change', updateUIMode);
          el.btnFactor.addEventListener('click', handleFactorisation);
          
          const inputs = ['inputA', 'inputB', 'inputK', 'inputA_common', 'inputB_common'];
          inputs.forEach(id => {
              el[id].addEventListener('input', () => { el.resultCard.hidden = true; updateLiveUI(); });
              el[id].addEventListener('keypress', (e) => {
                  if (e.key === 'Enter' && !el.btnFactor.disabled) { e.preventDefault(); handleFactorisation(); }
              });
          });

          const clearAction = () => {
              inputs.forEach(id => el[id].value = '');
              el.resultCard.hidden = true;
              showMsg('Champs effacÃ©s.');
              updateLiveUI();
          };
          el.btnClear.addEventListener('click', clearAction);
          el.btnNew.addEventListener('click', clearAction);

          el.btnCopyRedaction.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              navigator.clipboard.writeText(el.resultSteps.textContent)
                  .then(() => showMsg('RÃ©daction copiÃ©e.', 'success'))
                  .catch(() => showMsg('La copie a Ã©chouÃ©.', 'error'));
          });

          el.btnExportPDF.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const title = `Factorisation : ${el.liveExpression.textContent}`;
                const content = el.resultSteps.textContent;

                doc.setFont('Helvetica', 'bold');
                doc.text(title, 10, 15);

                doc.setFont('Courier', 'normal');
                const splitContent = doc.splitTextToSize(content, 180);
                doc.text(splitContent, 10, 25);
                
                doc.save('Factorisation_Pro_Redaction.pdf');
                showMsg('Export PDF gÃ©nÃ©rÃ©.', 'success');
              } catch (e) {
                showMsg('Erreur lors de la gÃ©nÃ©ration du PDF.', 'error');
                console.error(e);
              }
          });

          el.btnTheme.addEventListener('click', () => {
              const newTheme = document.body.classList.contains('theme-dark') ? 'theme-light' : 'theme-dark';
              document.body.className = newTheme;
              localStorage.setItem(LS_THEME, newTheme);
              el.btnTheme.textContent = newTheme === 'theme-dark' ? 'â˜€ï¸' : 'ğŸŒ™';
          });
          el.btnInfo.addEventListener('click', () => el.dlgHelp.showModal());
          el.btnHelpClose.addEventListener('click', () => el.dlgHelp.close());
      }
      
      document.addEventListener('DOMContentLoaded', () => {
          setupElements();
          const savedTheme = localStorage.getItem(LS_THEME) || 'theme-dark';
          document.body.className = savedTheme;
          el.btnTheme.textContent = savedTheme === 'theme-dark' ? 'â˜€ï¸' : 'ğŸŒ™';
          setupEventListeners();
          updateUIMode();
      });
    })();
  </script>
</body>
</html>
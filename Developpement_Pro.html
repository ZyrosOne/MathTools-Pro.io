<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Calculateur pour la double distributivit√© et les identit√©s remarquables avec d√©tail des √©tapes." />
  <meta name="color-scheme" content="light dark" />
  <title>D√©veloppement Pro | Identit√©s & Distributivit√©</title>
  <style>
    :root {
      --radius: 14px;
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --primary: #1976d2;
      --primary-dark: #1565c0;
      --transition: all 0.2s ease;
      --focus-glow: 0 0 0 3px rgba(25, 118, 210, 0.3);
    }
    body.theme-dark {
      --bg: #0f1115; --card: #161a22; --text: #e8ecf1; --muted: #9aa2af;
      --border: #232939; --input-bg: #0d1117; --placeholder: #5c6370;
      --accent: rgba(25, 118, 210, 0.15);
    }
    body.theme-light {
      --bg: #f6f8fc; --card: #ffffff; --text: #10141a; --muted: #586171;
      --border: #e5e9f1; --input-bg: #fefefe; --placeholder: #8a94a6;
      --accent: rgba(25, 118, 210, 0.08);
    }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.5; transition: var(--transition);
    }
    h1, h2, h3 { font-weight: 600; margin: 0; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .topbar {
      position: sticky; top: 0; z-index: 3; background: var(--card);
      border-bottom: 1px solid var(--border); padding: 12px 16px;
      display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .icon-btn, .btn {
      border: 1px solid var(--border); background: transparent; color: var(--text);
      border-radius: 10px; font-weight: 500; touch-action: manipulation;
      transition: var(--transition); cursor: pointer;
    }
    .icon-btn { padding: 8px 10px; font-size: 16px; display: inline-flex; align-items: center; justify-content: center; }
    .btn { padding: 10px 16px; font-size: 14px; }
    .btn:hover, .icon-btn:hover { background: var(--accent); border-color: rgba(25, 118, 210, 0.24); }
    .btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
    .btn[disabled] { opacity: 0.5; cursor: not-allowed; background: var(--accent); border-color: transparent; }

    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 16px; margin: 16px 0; animation: fadeIn 0.3s ease-out;
    }
    .card h2 { font-size: 18px; margin-bottom: 12px; }

    input[type="text"], select {
      background: var(--input-bg); color: var(--text);
      border: 1px solid var(--border); border-radius: 8px;
      padding: 10px 12px; font-size: 14px; transition: var(--transition);
    }
    input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: var(--focus-glow); }
    input[type="text"] { max-width: 100px; text-align: center; }
    
    .input-group { display: flex; flex-direction: column; gap: 16px; margin-top: 16px; }
    .input-row {
        display: flex; flex-wrap: wrap; align-items: center; gap: 10px;
        font-size: 16px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    #liveExpression {
        font-size: 20px; text-align: center; color: var(--primary);
        font-weight: 500; padding: 12px; background: var(--accent);
        border-radius: 10px; margin-top: 20px; transition: var(--transition);
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
        word-break: break-all;
        min-height: 1.5em;
    }

    pre {
      white-space: pre-wrap; margin: 0; background: var(--input-bg);
      border: 1px solid var(--border); border-radius: 10px; padding: 14px;
      font: 14px/1.7 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }

    .msg { margin-top: 12px; font-size: 13px; }
    .msg.error { color: #ff6b6b; } .msg.success { color: #4caf50; }

    dialog {
      border: 1px solid var(--border); background: var(--card); color: var(--text);
      border-radius: var(--radius); padding: 16px; max-width: 720px; 
      width: calc(100% - 32px); box-shadow: var(--shadow);
    }
    dialog::backdrop { background: rgba(0,0,0,0.4); }
    .dialog-actions { margin-top: 12px; display: flex; justify-content: flex-end; gap: 8px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    @keyframes dialog-show {
      from {
        opacity: 0;
        transform: scale(0.97) translateY(10px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    dialog[open] {
      animation: dialog-show 0.3s ease-out forwards;
    }

    @keyframes backdrop-fade-in {
      from { background: rgba(0, 0, 0, 0); }
      to { background: rgba(0, 0, 0, 0.4); }
    }

    dialog[open]::backdrop {
      animation: backdrop-fade-in 0.3s ease-out forwards;
    }

    .dropdown { position: relative; }
    .dropdown-summary { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 600; cursor: pointer; list-style: none; padding: 4px 8px; border-radius: 8px; transition: var(--transition); }
    .dropdown-summary:hover { background: var(--accent); }
    .dropdown-summary::-webkit-details-marker { display: none; }
    .dropdown-summary .arrow { transition: transform 0.2s ease; }
    details[open] > .dropdown-summary .arrow { transform: rotate(180deg); }
    .dropdown-menu { position: absolute; top: calc(100% + 8px); left: 0; z-index: 10; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); width: 280px; padding: 8px; opacity: 0; transform: translateY(-10px); pointer-events: none; transition: opacity 0.2s ease, transform 0.2s ease; }
    details[open] > .dropdown-menu { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .dropdown-menu a { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; text-decoration: none; color: var(--text); font-size: 14px; font-weight: 500; }
    .dropdown-menu a:hover { background: var(--accent); }
    .dropdown-menu a.active { font-weight: 600; color: var(--primary); background: var(--accent); }
    .dropdown-menu .emoji { font-size: 18px; }
    .dropdown-menu hr { border: none; border-top: 1px solid var(--border); margin: 8px 0; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="theme-dark">
  <header class="topbar">
    <details class="dropdown">
      <summary class="dropdown-summary">
        <span class="emoji">‚öôÔ∏è</span>
        <span>D√©veloppement Pro</span>
        <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M7 10l5 5 5-5H7z"></path></svg>
      </summary>
      <nav class="dropdown-menu">
        <a href="index.html"><span class="emoji">üî¢</span><span>Menu Principal</span></a>
        <hr>
        <a href="Pythagore_pro.html"><span class="emoji">üßÆ</span><span>Pythagore Pro</span></a>
        <a href="Thales_Pro.html"><span class="emoji">üìê</span><span>Thal√®s Pro</span></a>
        <a href="Developpement_Pro.html" class="active"><span class="emoji">‚öôÔ∏è</span><span>D√©veloppement Pro</span></a>
        <a href="Factorisation_Pro.html"><span class="emoji">üß©</span><span>Factorisation Pro</span></a>
        <a href="Equation_Premier_Degre_Pro.html"><span class="emoji">‚öñÔ∏è</span><span>√âquation Pro (1er degr√©)</span></a>
        <a href="Statistique_Pro.html"><span class="emoji">üìä</span><span>Statistique Pro</span></a>
      </nav>
    </details>
    <div class="actions">
      <button id="btnTheme" class="icon-btn" title="Changer de th√®me">üåì</button>
      <button id="btnInfo" class="icon-btn" title="Aide">‚ÑπÔ∏è</button>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="section-calc">
      <h2 id="section-calc">Choisissez un mode et entrez les valeurs :</h2>

      <div class="field">
        <label for="modeSelect">Mode de calcul</label>
        <select id="modeSelect">
          <option value="distributivity">Double Distributivit√© : (a+b)(c+d)</option>
          <option value="aplusb_sq">Identit√© Remarquable : (a+b)¬≤</option>
          <option value="aminusb_sq">Identit√© Remarquable : (a-b)¬≤</option>
          <option value="aplusb_aminusb">Identit√© Remarquable : (a+b)(a-b)</option>
        </select>
      </div>

      <div class="input-group">
        <div class="input-row">
            <span>a =</span>
            <input id="inputA" type="text" inputmode="decimal" value="" placeholder="a">
            <span>b =</span>
            <input id="inputB" type="text" inputmode="decimal" value="" placeholder="b">
        </div>
        <div class="input-row" id="groupCD">
            <span>c =</span>
            <input id="inputC" type="text" inputmode="decimal" value="" placeholder="c">
            <span>d =</span>
            <input id="inputD" type="text" inputmode="decimal" value="" placeholder="d">
        </div>
      </div>
      
      <div id="liveExpression"></div>
    </section>

    <section class="card">
      <div class="actions">
        <button id="btnDevelop" class="btn primary" disabled>D√©velopper</button>
        <button id="btnClear" class="btn">Effacer</button>
      </div>
      <div id="msg" class="msg" role="status" aria-live="polite"></div>
    </section>

    <section id="resultCard" class="card" hidden>
      <pre id="resultSteps"></pre>
      <div class="actions" style="margin-top:10px; gap: 8px;">
        <button id="btnCopyRedaction" class="btn">Copier la r√©daction</button>
        <button id="btnNew" class="btn">Nouveau</button>
        <button id="btnExportPDF" class="btn">Exporter en PDF</button>
      </div>
    </section>
  </main>

  <dialog id="dlgHelp">
    <h3 id="helpTitle">Aide ‚Ä¢ D√©veloppement Pro</h3>
    <p>Cet outil d√©veloppe des expressions alg√©briques simples, √©tape par √©tape.</p>
    <ul>
      <li><strong>Choisissez un mode :</strong> S√©lectionnez la Double Distributivit√© ou l'une des trois Identit√©s Remarquables.</li>
      <li><strong>Entrez les valeurs :</strong> Remplissez les champs qui apparaissent. Ils peuvent √™tre positifs ou n√©gatifs.</li>
      <li><strong>Pr√©visualisez :</strong> Une expression en direct vous montre √† quoi ressemble votre calcul.</li>
      <li><strong>D√©veloppez :</strong> Le bouton s'active quand les valeurs sont valides. Cliquez pour obtenir la r√©daction d√©taill√©e du calcul.</li>
    </ul>
    <div class="dialog-actions">
      <button id="btnHelpClose" class="btn">Fermer</button>
    </div>
  </dialog>

  <script>
    (function () {
      'use strict';
      
      const LS_THEME = 'dev_theme_v3';
      const el = {};
      let state = { mode: 'distributivity' };

      function byId(id) { return document.getElementById(id); }

      function setupElements() {
          const ids = [
              'modeSelect', 'inputA', 'inputB', 'inputC', 'inputD', 'groupCD', 'liveExpression', 
              'btnDevelop', 'btnClear', 'msg', 'resultCard', 'resultSteps', 
              'btnTheme', 'btnInfo', 'dlgHelp', 'btnHelpClose',
              'btnCopyRedaction', 'btnNew', 'btnExportPDF'
          ];
          ids.forEach(id => el[id] = byId(id));
      }

      function showMsg(message, type = 'info') {
        el.msg.textContent = message;
        el.msg.className = `msg ${type || 'info'}`;
      }

      const format = {
          num: n => n.toLocaleString('fr-FR', {maximumFractionDigits: 4}),
          parenthesis: n => n < 0 ? `(${format.num(n)})` : format.num(n),
          sign: n => n < 0 ? ` - ${format.num(Math.abs(n))}` : ` + ${format.num(n)}`
      };

      function parseInput(id) {
          const val = el[id]?.value.trim().replace(',', '.');
          if (val === '' || val ==='-') return NaN;
          const num = parseFloat(val);
          return isFinite(num) ? num : NaN;
      }

      function getInputs() {
          return {
              a: parseInput('inputA'), b: parseInput('inputB'),
              c: parseInput('inputC'), d: parseInput('inputD')
          };
      }

      function updateUIMode() {
          state.mode = el.modeSelect.value;
          const showCD = state.mode === 'distributivity';
          el.groupCD.style.display = showCD ? 'flex' : 'none';
          
          updateLiveUI();
          el.resultCard.hidden = true;
      }
      
      function updateLiveUI() {
          const v = getInputs();
          const allValid = (state.mode === 'distributivity')
              ? [v.a, v.b, v.c, v.d].every(isFinite)
              : [v.a, v.b].every(isFinite);

          const term = (val, name) => isFinite(val) ? format.num(val) : name;
          const signedTerm = (val, name) => isFinite(val) 
              ? (val < 0 ? ` - ${format.num(Math.abs(val))}` : ` + ${format.num(val)}`) 
              : ` + ${name}`;

          let expr = '';
          switch (state.mode) {
              case 'distributivity':
                  expr = `(${term(v.a, 'a')}${signedTerm(v.b, 'b')}) √ó (${term(v.c, 'c')}${signedTerm(v.d, 'd')})`;
                  break;
              case 'aplusb_sq':
                  expr = `(${term(v.a, 'a')}${signedTerm(v.b, 'b')})¬≤`;
                  break;
              case 'aminusb_sq':
                  expr = `(${term(v.a, 'a')} - ${term(v.b, 'b')})¬≤`;
                  break;
              case 'aplusb_aminusb':
                  expr = `(${term(v.a, 'a')}${signedTerm(v.b, 'b')})(${term(v.a, 'a')}${signedTerm(-v.b, 'b')})`;
                  break;
          }
          el.liveExpression.textContent = expr;
          el.btnDevelop.disabled = !allValid;
      }
      
      function generateSteps(v) {
          const { a, b, c, d } = v;
          let steps = [], title = '', result;

          switch (state.mode) {
              case 'distributivity':
                  const p1 = a*c, p2 = a*d, p3 = b*c, p4 = b*d;
                  result = p1+p2+p3+p4;
                  title = 'On applique la double distributivit√© :';
                  steps.push(`(${format.parenthesis(a)}${format.sign(b)}) √ó (${format.parenthesis(c)}${format.sign(d)})`);
                  steps.push(`= ${format.parenthesis(a)}√ó${format.parenthesis(c)} + ${format.parenthesis(a)}√ó${format.parenthesis(d)} + ${format.parenthesis(b)}√ó${format.parenthesis(c)} + ${format.parenthesis(b)}√ó${format.parenthesis(d)}`);
                  steps.push(`= ${format.num(p1)} ${format.sign(p2)} ${format.sign(p3)} ${format.sign(p4)}`);
                  break;
              
              case 'aplusb_sq':
                  result = a*a + 2*a*b + b*b;
                  title = `On applique l'identit√© remarquable (a+b)¬≤ = a¬≤ + 2ab + b¬≤ :`;
                  steps.push(`(${format.parenthesis(a)} + ${format.parenthesis(b)})¬≤`);
                  steps.push(`= ${format.parenthesis(a)}¬≤ + 2√ó${format.parenthesis(a)}√ó${format.parenthesis(b)} + ${format.parenthesis(b)}¬≤`);
                  steps.push(`= ${format.num(a*a)} + ${format.num(2*a*b)} + ${format.num(b*b)}`);
                  break;

              case 'aminusb_sq':
                  result = a*a - 2*a*b + b*b;
                  title = `On applique l'identit√© remarquable (a-b)¬≤ = a¬≤ - 2ab + b¬≤ :`;
                  steps.push(`(${format.parenthesis(a)} - ${format.parenthesis(b)})¬≤`);
                  steps.push(`= ${format.parenthesis(a)}¬≤ - 2√ó${format.parenthesis(a)}√ó${format.parenthesis(b)} + ${format.parenthesis(b)}¬≤`);
                  steps.push(`= ${format.num(a*a)} - ${format.num(2*a*b)} + ${format.num(b*b)}`);
                  break;

              case 'aplusb_aminusb':
                  result = a*a - b*b;
                  title = `On applique l'identit√© remarquable (a+b)(a-b) = a¬≤ - b¬≤ :`;
                  steps.push(`(${format.parenthesis(a)} + ${format.parenthesis(b)})(${format.parenthesis(a)} - ${format.parenthesis(b)})`);
                  steps.push(`= ${format.parenthesis(a)}¬≤ - ${format.parenthesis(b)}¬≤`);
                  steps.push(`= ${format.num(a*a)} - ${format.num(b*b)}`);
                  break;
          }
          steps.push(`= ${format.num(result)}`);
          steps.push(`\nConclusion : Le d√©veloppement complet donne ${format.num(result)}.`);
          return `${title}\n\n${steps.join('\n')}`;
      }

      function handleDevelopment() {
          el.resultCard.hidden = true;
          try {
              const values = getInputs();
              const steps = generateSteps(values);
              el.resultSteps.textContent = steps;
              el.resultCard.hidden = false;
              showMsg('D√©veloppement r√©ussi.', 'success');
          } catch (e) {
              showMsg(e.message || 'Erreur inconnue.', 'error');
          }
      }

      function setupEventListeners() {
          el.modeSelect.addEventListener('change', updateUIMode);
          el.btnDevelop.addEventListener('click', handleDevelopment);
          
          ['inputA', 'inputB', 'inputC', 'inputD'].forEach(id => {
              el[id].addEventListener('input', () => { el.resultCard.hidden = true; updateLiveUI(); });
              el[id].addEventListener('keypress', (e) => {
                  if (e.key === 'Enter' && !el.btnDevelop.disabled) { e.preventDefault(); handleDevelopment(); }
              });
          });

          const clearAction = () => {
              ['inputA', 'inputB', 'inputC', 'inputD'].forEach(id => el[id].value = '');
              el.resultCard.hidden = true;
              showMsg('Champs effac√©s.');
              updateLiveUI();
          };
          el.btnClear.addEventListener('click', clearAction);
          el.btnNew.addEventListener('click', clearAction);

          el.btnCopyRedaction.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              navigator.clipboard.writeText(el.resultSteps.textContent)
                  .then(() => showMsg('R√©daction copi√©e.', 'success'))
                  .catch(() => showMsg('La copie a √©chou√©.', 'error'));
          });

          el.btnExportPDF.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const title = `D√©veloppement de: ${el.liveExpression.textContent}`;
                const content = el.resultSteps.textContent;

                doc.setFont('Helvetica', 'bold');
                doc.text(title, 10, 15);

                doc.setFont('Courier', 'normal');
                const splitContent = doc.splitTextToSize(content, 180);
                doc.text(splitContent, 10, 25);
                
                doc.save('Developpement_Pro_Redaction.pdf');
                showMsg('Export PDF g√©n√©r√©.', 'success');
              } catch (e) {
                showMsg('Erreur lors de la g√©n√©ration du PDF.', 'error');
                console.error(e);
              }
          });

          el.btnTheme.addEventListener('click', () => {
              const newTheme = document.body.classList.contains('theme-dark') ? 'theme-light' : 'theme-dark';
              document.body.className = newTheme;
              localStorage.setItem(LS_THEME, newTheme);
              el.btnTheme.textContent = newTheme === 'theme-dark' ? '‚òÄÔ∏è' : 'üåô';
          });
          el.btnInfo.addEventListener('click', () => el.dlgHelp.showModal());
          el.btnHelpClose.addEventListener('click', () => el.dlgHelp.close());
      }
      
      document.addEventListener('DOMContentLoaded', () => {
          setupElements();
          const savedTheme = localStorage.getItem(LS_THEME) || 'theme-dark';
          document.body.className = savedTheme;
          el.btnTheme.textContent = savedTheme === 'theme-dark' ? '‚òÄÔ∏è' : 'üåô';
          setupEventListeners();
          updateUIMode();
      });
    })();
  </script>
</body>
</html>
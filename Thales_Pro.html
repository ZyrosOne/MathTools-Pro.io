<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Calculateur pour le th√©or√®me de Thal√®s et sa r√©ciproque, avec visualisation et r√©daction." />
  <meta name="color-scheme" content="light dark" />
  <title>Thal√®s Pro | Calculateur de th√©or√®me de Thal√®s</title>
  <style>
    :root {
      --radius: 14px;
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --primary: #1976d2;
      --primary-dark: #1565c0;
      --transition: all 0.2s ease;
      --focus-glow: 0 0 0 3px rgba(25, 118, 210, 0.3);
    }
    body.theme-dark {
      --bg: #0f1115; --card: #161a22; --text: #e8ecf1; --muted: #9aa2af;
      --border: #232939; --input-bg: #0d1117; --placeholder: #5c6370;
      --accent: rgba(25, 118, 210, 0.15);
    }
    body.theme-light {
      --bg: #f6f8fc; --card: #ffffff; --text: #10141a; --muted: #586171;
      --border: #e5e9f1; --input-bg: #fefefe; --placeholder: #8a94a6;
      --accent: rgba(25, 118, 210, 0.08);
    }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.5; transition: var(--transition);
    }
    h1, h2, h3 { font-weight: 600; margin: 0; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .topbar {
      position: sticky; top: 0; z-index: 3; background: var(--card);
      border-bottom: 1px solid var(--border); padding: 12px 16px;
      display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .icon-btn, .btn {
      border: 1px solid var(--border); background: transparent; color: var(--text);
      border-radius: 10px; font-weight: 500; touch-action: manipulation;
      transition: var(--transition); cursor: pointer;
    }
    .icon-btn { padding: 8px 10px; font-size: 16px; display: inline-flex; align-items: center; justify-content: center; }
    .btn { padding: 10px 16px; font-size: 14px; }
    .btn:hover, .icon-btn:hover { background: var(--accent); border-color: rgba(25, 118, 210, 0.24); }
    .btn.primary, .btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .btn[disabled] { opacity: 0.6; cursor: not-allowed; }

    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 16px; margin: 16px 0; animation: fadeIn 0.3s ease-out;
    }
    .card h2 { font-size: 18px; margin-bottom: 12px; }

    .config-bar { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }

    input[type="text"], select {
      width: 100%; background: var(--input-bg); color: var(--text);
      border: 1px solid var(--border); border-radius: 8px;
      padding: 10px 12px; font-size: 14px; transition: var(--transition);
      box-sizing: border-box;
    }
    input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: var(--focus-glow); }
    input[disabled] { opacity: 0.5; background: var(--accent); }

    /* R√®gle originale pour les menus du haut */
    .input-grid { display: grid; gap: 14px; margin-top: 12px; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
    
    /* NOUVELLE R√àGLE, uniquement pour les 6 champs de saisie */
    .input-fields-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px;
      margin-top: 12px;
    }
    .input-fields-container .field {
      flex: 1 1 120px;
      max-width: 200px;
    }
    
    .field { display: flex; flex-direction: column; gap: 6px; }
    .field label { font-weight: 500; font-size: 14px; }

    #canvas {
      width: 100%; height: clamp(220px, 34vh, 380px); display: block;
      background: var(--accent); border: 1px dashed var(--border);
      border-radius: 12px; margin-top: 16px;
    }

    pre {
      white-space: pre-wrap; margin: 0; background: var(--input-bg);
      border: 1px solid var(--border); border-radius: 10px; padding: 14px;
      font: 13px/1.6 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }

    .msg { margin-top: 8px; font-size: 13px; }
    .msg.error { color: #ff6b6b; }
    .msg.success { color: #4caf50; }

    dialog {
      border: 1px solid var(--border); background: var(--card); color: var(--text);
      border-radius: var(--radius); padding: 16px; max-width: 720px; 
      width: calc(100% - 32px); box-shadow: var(--shadow);
    }
    dialog::backdrop { background: rgba(0,0,0,0.4); }
    .dialog-actions { margin-top: 12px; display: flex; justify-content: flex-end; gap: 8px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    @keyframes dialog-show {
      from { opacity: 0; transform: scale(0.97) translateY(10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    dialog[open] { animation: dialog-show 0.3s ease-out forwards; }

    @keyframes backdrop-fade-in {
      from { background: rgba(0, 0, 0, 0); }
      to { background: rgba(0, 0, 0, 0.4); }
    }
    dialog[open]::backdrop { animation: backdrop-fade-in 0.3s ease-out forwards; }
    
    .dropdown { position: relative; }
    .dropdown-summary { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 600; cursor: pointer; list-style: none; padding: 4px 8px; border-radius: 8px; transition: var(--transition); }
    .dropdown-summary:hover { background: var(--accent); }
    .dropdown-summary::-webkit-details-marker { display: none; }
    .dropdown-summary .arrow { transition: transform 0.2s ease; }
    details[open] > .dropdown-summary .arrow { transform: rotate(180deg); }
    .dropdown-menu { position: absolute; top: calc(100% + 8px); left: 0; z-index: 10; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); width: 280px; padding: 8px; opacity: 0; transform: translateY(-10px); pointer-events: none; transition: opacity 0.2s ease, transform 0.2s ease; }
    details[open] > .dropdown-menu { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .dropdown-menu a { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; text-decoration: none; color: var(--text); font-size: 14px; font-weight: 500; }
    .dropdown-menu a:hover { background: var(--accent); }
    .dropdown-menu a.active { font-weight: 600; color: var(--primary); background: var(--accent); }
    .dropdown-menu .emoji { font-size: 18px; }
    .dropdown-menu hr { border: none; border-top: 1px solid var(--border); margin: 8px 0; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="theme-dark">
  <header class="topbar">
    <details class="dropdown">
      <summary class="dropdown-summary">
        <span class="emoji">üìê</span>
        <span>Thal√®s Pro</span>
        <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M7 10l5 5 5-5H7z"></path></svg>
      </summary>
      <nav class="dropdown-menu">
        <a href="index.html"><span class="emoji">üî¢</span><span>Menu Principal</span></a>
        <hr>
        <a href="Pythagore_pro.html"><span class="emoji">üßÆ</span><span>Pythagore Pro</span></a>
        <a href="Thales_Pro.html" class="active"><span class="emoji">üìê</span><span>Thal√®s Pro</span></a>
        <a href="Developpement_Pro.html"><span class="emoji">‚öôÔ∏è</span><span>D√©veloppement Pro</span></a>
        <a href="Factorisation_Pro.html"><span class="emoji">üß©</span><span>Factorisation Pro</span></a>
        <a href="Equation_Premier_Degre_Pro.html"><span class="emoji">‚öñÔ∏è</span><span>√âquation Pro (1er degr√©)</span></a>
        <a href="Statistique_Pro.html"><span class="emoji">üìä</span><span>Statistique Pro</span></a>
      </nav>
    </details>
    <div class="actions">
      <button id="btnTheme" class="icon-btn" title="Changer de th√®me">üåì</button>
      <button id="btnInfo" class="icon-btn" title="Aide">‚ÑπÔ∏è</button>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="section-calc">
      <h2 id="section-calc">Param√®tres et donn√©es</h2>

      <!-- Ce bloc utilise la mise en page originale 'grid' -->
      <div class="input-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
        <div class="field">
          <label for="mode">Choisissez le mode :</label>
          <select id="mode">
            <option value="theorem">Th√©or√®me de Thal√®s (Calculer)</option>
            <option value="reciprocal">R√©ciproque de Thal√®s (V√©rifier)</option>
          </select>
        </div>
        <div class="field">
          <label for="unknown">Longueur √† calculer :</label>
          <select id="unknown">
            <option value="AD">AD</option> <option value="AB">AB</option>
            <option value="AE">AE</option> <option value="AC">AC</option>
            <option value="DE">DE</option> <option value="BC">BC</option>
          </select>
        </div>
      </div>
      
      <div style="margin-top: 16px;">
        <label>Configuration des points :</label>
        <div class="config-bar">
          <button id="configNested" class="btn active" data-config="nested">Triangles embo√Æt√©s</button>
          <button id="configButterfly" class="btn" data-config="butterfly">Papillon</button>
        </div>
      </div>

      <!-- CE BLOC UTILISE LA NOUVELLE CLASSE pour le centrage -->
      <div class="input-fields-container">
        <div class="field"><label for="inputAD">AD</label><input type="text" id="inputAD" inputmode="decimal"></div>
        <div class="field"><label for="inputAB">AB</label><input type="text" id="inputAB" inputmode="decimal"></div>
        <div class="field"><label for="inputAE">AE</label><input type="text" id="inputAE" inputmode="decimal"></div>
        <div class="field"><label for="inputAC">AC</label><input type="text" id="inputAC" inputmode="decimal"></div>
        <div class="field"><label for="inputDE">DE</label><input type="text" id="inputDE" inputmode="decimal"></div>
        <div class="field"><label for="inputBC">BC</label><input type="text" id="inputBC" inputmode="decimal"></div>
      </div>
      
      <canvas id="canvas" aria-label="Visualisation de la configuration de Thal√®s"></canvas>
    </section>

    <section class="card">
      <div class="actions">
        <button id="btnCalc" class="btn primary">Calculer</button>
        <button id="btnClear" class="btn">Effacer</button>
      </div>
      <div id="msg" class="msg" role="status" aria-live="polite"></div>
    </section>

    <section id="resultCard" class="card" hidden>
      <h3 id="resultTitle"></h3>
      <hr style="border:none;border-top:1px solid var(--border); margin: 8px 0;">
      <pre id="resultSteps"></pre>
      <div class="actions" style="margin-top:16px; justify-content: flex-end; gap: 8px;">
        <button id="btnCopyRedaction" class="btn">Copier la r√©daction</button>
        <button id="btnNew" class="btn">Nouveau</button>
        <button id="btnExportPDF" class="btn">Exporter en PDF</button>
      </div>
    </section>
    
  </main>

  <dialog id="dlgHelp">
    <h3>Aide ‚Ä¢ Thal√®s Pro</h3>
    <p>Cet outil vous aide √† appliquer le th√©or√®me de Thal√®s et sa r√©ciproque.</p>
    <ul>
      <li><strong>Th√©or√®me :</strong> Calcule une longueur manquante. Choisissez-la, puis entrez au moins trois autres longueurs pour former un rapport.</li>
      <li><strong>R√©ciproque :</strong> V√©rifie si les droites sont parall√®les. Entrez les quatre longueurs des segments s√©cants (AD, AB, AE, AC).</li>
      <li><strong>Configuration :</strong> Choisissez "Triangles embo√Æt√©s" (A,D,B align√©s) ou "Papillon" (D,A,B align√©s).</li>
    </ul>
    <div class="dialog-actions">
      <button id="btnHelpClose" class="btn">Fermer</button>
    </div>
  </dialog>

  <script>
    (function () {
      'use strict';
      
      const LS_THEME = 'thales_theme';
      const EPSILON = 1e-9;
      let state = { mode: 'theorem', config: 'nested', unknown: 'BC' };
      const el = {};

      function setupElements() {
          const ids = ['mode', 'unknown', 'configNested', 'configButterfly', 'inputAD', 'inputAB', 'inputAE', 'inputAC', 'inputDE', 'inputBC', 'canvas', 'btnCalc', 'btnClear', 'msg', 'resultCard', 'resultTitle', 'resultSteps', 'btnTheme', 'btnInfo', 'dlgHelp', 'btnHelpClose', 'btnCopyRedaction', 'btnNew', 'btnExportPDF'];
          ids.forEach(id => el[id] = document.getElementById(id));
          el.ctx = el.canvas.getContext('2d');
      }

      function formatNumber(n) { return n.toLocaleString('fr-FR', { maximumFractionDigits: 4 }); }
      function parseInput(id) {
          const val = el[id]?.value.trim().replace(',', '.');
          const num = parseFloat(val);
          return isFinite(num) && num > 0 ? num : NaN;
      }
      function getInputs() { return { AD: parseInput('inputAD'), AB: parseInput('inputAB'), AE: parseInput('inputAE'), AC: parseInput('inputAC'), DE: parseInput('inputDE'), BC: parseInput('inputBC') }; }

      function showMsg(message, type = 'info') {
        el.msg.textContent = message;
        el.msg.className = `msg ${type || 'info'}`;
      }

      function updateUI() {
          el.btnCalc.textContent = state.mode === 'theorem' ? 'Calculer' : 'V√©rifier';
          document.getElementById('unknown').parentElement.style.display = state.mode === 'theorem' ? '' : 'none';
          el.configNested.classList.toggle('active', state.config === 'nested');
          el.configButterfly.classList.toggle('active', state.config === 'butterfly');
          ['inputAD', 'inputAB', 'inputAE', 'inputAC', 'inputDE', 'inputBC'].forEach(id => el[id].disabled = false);
          if (state.mode === 'theorem') {
            el['input' + state.unknown].disabled = true;
            el['input' + state.unknown].value = '';
          } else { 
            el.inputDE.disabled = true; el.inputBC.disabled = true; 
            el.inputDE.value = ''; el.inputBC.value = '';
          }
          drawThales();
      }
      
      function calculate() {
          const v = getInputs();
          if (state.mode === 'theorem') {
              let result = NaN, calcParts = {};
              const { unknown } = state;
              
              const ratios = [
                  { known: [v.AE, v.AC], toFind: [v.AD, v.AB], knownLabels: ['AE', 'AC'], findLabels: ['AD', 'AB'] },
                  { known: [v.AD, v.AB], toFind: [v.AE, v.AC], knownLabels: ['AD', 'AB'], findLabels: ['AE', 'AC'] },
                  { known: [v.DE, v.BC], toFind: [v.AD, v.AB], knownLabels: ['DE', 'BC'], findLabels: ['AD', 'AB'] },
                  { known: [v.AD, v.AB], toFind: [v.DE, v.BC], knownLabels: ['AD', 'AB'], findLabels: ['DE', 'BC'] },
                  { known: [v.DE, v.BC], toFind: [v.AE, v.AC], knownLabels: ['DE', 'BC'], findLabels: ['AE', 'AC'] },
                  { known: [v.AE, v.AC], toFind: [v.DE, v.BC], knownLabels: ['AE', 'AC'], findLabels: ['DE', 'BC'] },
              ];
              
              for (const r of ratios) {
                  if (r.findLabels.includes(unknown) && !isNaN(r.known[0]) && !isNaN(r.known[1])) {
                      const ratio = r.known[0] / r.known[1];
                      if (unknown === r.findLabels[0] && !isNaN(r.toFind[1])) { // find numerator
                          result = r.toFind[1] * ratio;
                          calcParts = { val1: r.toFind[1], val2: r.known[0], val3: r.known[1] };
                          break;
                      }
                      if (unknown === r.findLabels[1] && !isNaN(r.toFind[0])) { // find denominator
                          result = r.toFind[0] / ratio;
                          calcParts = { val1: r.toFind[0], val2: r.known[1], val3: r.known[0] };
                          break;
                      }
                  }
              }

              if (!isFinite(result) || result <= 0) {
                  throw new Error('Donn√©es insuffisantes. Il faut 3 longueurs valides pour faire un produit en croix.');
              }
              return { success: true, value: result, inputs: v, calcParts };

          } else {
              if (![v.AD, v.AB, v.AE, v.AC].every(val => isFinite(val) && val > 0)) {
                  throw new Error('Veuillez entrer les 4 longueurs AD, AB, AE et AC.');
              }
              const ratio1 = v.AD / v.AB, ratio2 = v.AE / v.AC;
              return { success: true, areParallel: Math.abs(ratio1 - ratio2) < EPSILON, ratio1, ratio2, inputs: v };
          }
      }

      function renderResults(res) {
          let title = '', steps = '';
          const v = res.inputs;
          if (state.mode === 'theorem') {
              title = `‚úÖ Calcul de ${state.unknown} : ${formatNumber(res.value)}`;
              steps = `1. Hypoth√®ses :\n` +
                      `   - Les droites (DB) et (EC) sont s√©cantes en A.\n` +
                      `   - Les droites (DE) et (BC) sont parall√®les.\n\n` +
                      `2. Th√©or√®me :\n` +
                      `   D'apr√®s le th√©or√®me de Thal√®s, on a l'√©galit√© des rapports :\n` +
                      `   AD / AB = AE / AC = DE / BC\n\n` +
                      `3. Calcul (produit en croix) :\n` +
                      `   ${state.unknown} = (${formatNumber(res.calcParts.val1)} √ó ${formatNumber(res.calcParts.val2)}) / ${formatNumber(res.calcParts.val3)}\n` +
                      `   ${state.unknown} ‚âà ${formatNumber(res.value)}\n\n` +
                      `Conclusion : La longueur du segment [${state.unknown}] est d'environ ${formatNumber(res.value)}.`;
          } else {
              title = res.areParallel ? '‚úÖ Les droites (DE) et (BC) sont parall√®les.' : '‚ùå Les droites ne sont pas parall√®les.';
              const order = state.config === 'nested' ? 'A, D, B et A, E, C' : 'D, A, B et E, A, C';
              steps = `1. Hypoth√®ses :\n` +
                      `   - Les points ${order} sont align√©s dans le m√™me ordre.\n\n` +
                      `2. Calcul des rapports :\n` +
                      `   - D'une part : AD / AB = ${formatNumber(v.AD)} / ${formatNumber(v.AB)} ‚âà ${formatNumber(res.ratio1)}\n` +
                      `   - D'autre part : AE / AC = ${formatNumber(v.AE)} / ${formatNumber(v.AC)} ‚âà ${formatNumber(res.ratio2)}\n\n` +
                      `3. Comparaison :\n` +
                      `   On constate que AD / AB ${res.areParallel ? '‚âà' : '‚â†'} AE / AC.\n\n` +
                      `Conclusion : D'apr√®s la ${res.areParallel ? 'r√©ciproque' : 'contrapos√©e'} du th√©or√®me de Thal√®s, les droites (DE) et (BC) ${res.areParallel ? 'sont' : 'ne sont pas'} parall√®les.`;
          }
          el.resultTitle.innerHTML = title;
          el.resultSteps.textContent = steps;
          el.resultCard.hidden = false;
      }

      function drawThales() {
        const { ctx, canvas } = el;
        const { width, height } = canvas;
        ctx.clearRect(0, 0, width, height);
        const v = getInputs();
        let { AD, AB } = v;
        
        let ratio = !isNaN(AD) && !isNaN(AB) && AB > 0 ? AD / AB : 0.5;
        if(ratio > 5) ratio = 5; if(ratio < 0.05) ratio = 0.05;

        const PADDING = 30, centerX = width / 2;
        const availableHeight = height - 2 * PADDING;
        const availableWidth = width - 2 * PADDING;
        let A, B, C, D, E;

        ctx.font = '14px sans-serif';
        const textColor = getComputedStyle(document.body).getPropertyValue('--text');
        ctx.fillStyle = textColor;

        if (state.config === 'nested') {
            A = { x: centerX, y: PADDING };
            B = { x: A.x - availableWidth / 2.2, y: A.y + availableHeight };
            C = { x: A.x + availableWidth / 2.2, y: A.y + availableHeight };
            D = { x: A.x + (B.x - A.x) * ratio, y: A.y + (B.y - A.y) * ratio };
            E = { x: A.x + (C.x - A.x) * ratio, y: A.y + (C.y - A.y) * ratio };
        } else { // butterfly
            const midY = PADDING + availableHeight / 2;
            A = { x: centerX, y: midY };
            const hRatio = Math.min(ratio, 1) * 0.8;
            
            B = { x: A.x - availableWidth / 2, y: A.y + availableHeight / 2 };
            C = { x: A.x + availableWidth / 2, y: A.y + availableHeight / 2 };
            D = { x: A.x + (A.x - B.x) * hRatio, y: A.y + (A.y - B.y) * hRatio };
            E = { x: A.x + (A.x - C.x) * hRatio, y: A.y + (A.y - C.y) * hRatio };
        }
        
        ctx.strokeStyle = textColor; ctx.lineWidth = 1.5;
        ctx.beginPath(); ctx.moveTo(D.x, D.y); ctx.lineTo(B.x, B.y); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(E.x, E.y); ctx.lineTo(C.x, C.y); ctx.stroke();
        
        ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--primary'); ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(D.x, D.y); ctx.lineTo(E.x, E.y); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(B.x, B.y); ctx.lineTo(C.x, C.y); ctx.stroke();
        
        ctx.fillStyle = textColor;
        Object.entries({A,B,C,D,E}).forEach(([name, p]) => { 
          ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, 2*Math.PI); ctx.fill(); 
          ctx.fillText(name, p.x + 8, p.y + 4); 
        });
      }

      function handleCalculation() {
          el.resultCard.hidden = true;
          try {
              const result = calculate();
              renderResults(result);
              showMsg('Calcul r√©ussi !', 'success');
          } catch (e) {
              showMsg(e.message, 'error');
          }
      }

      function setupEventListeners() {
          el.mode.addEventListener('change', (e) => { state.mode = e.target.value; updateUI(); el.resultCard.hidden = true; showMsg(''); });
          el.unknown.addEventListener('change', (e) => { state.unknown = e.target.value; updateUI(); });
          el.configNested.addEventListener('click', () => { state.config = 'nested'; updateUI(); });
          el.configButterfly.addEventListener('click', () => { state.config = 'butterfly'; updateUI(); });
          Object.keys(getInputs()).forEach(key => el['input' + key].addEventListener('input', () => { el.resultCard.hidden = true; showMsg(''); drawThales(); }));
          el.btnCalc.addEventListener('click', handleCalculation);
          
          const clearAction = () => { 
            Object.keys(getInputs()).forEach(key => el['input' + key].value = ''); 
            el.resultCard.hidden = true; 
            showMsg('Champs effac√©s.'); 
            updateUI();
          };
          el.btnClear.addEventListener('click', clearAction);
          el.btnNew.addEventListener('click', clearAction);

          el.btnCopyRedaction.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              const text = el.resultTitle.innerText + '\n\n' + el.resultSteps.textContent;
              navigator.clipboard.writeText(text).then(() => {
                  showMsg('R√©daction copi√©e dans le presse-papiers.', 'success');
              }, () => {
                  showMsg('Erreur lors de la copie.', 'error');
              });
          });
          
          el.btnExportPDF.addEventListener('click', () => {
              if (el.resultCard.hidden) return;
              try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const title = el.resultTitle.innerText;
                const content = el.resultSteps.textContent;

                doc.setFont('Helvetica', 'bold');
                doc.text(title, 10, 15);
                
                doc.setFont('Helvetica', 'normal');
                const splitContent = doc.splitTextToSize(content, 180);
                doc.text(splitContent, 10, 25);
                
                doc.save('Thales_Pro_Redaction.pdf');
                showMsg('Export PDF g√©n√©r√©.', 'success');
              } catch (e) {
                showMsg('Erreur lors de la g√©n√©ration du PDF.', 'error');
                console.error(e);
              }
          });

          el.btnTheme.addEventListener('click', () => {
              const newTheme = document.body.classList.contains('theme-dark') ? 'theme-light' : 'theme-dark';
              document.body.className = newTheme; 
              localStorage.setItem(LS_THEME, newTheme);
              el.btnTheme.textContent = newTheme === 'theme-dark' ? '‚òÄÔ∏è' : 'üåô'; 
              drawThales();
          });
          el.btnInfo.addEventListener('click', () => el.dlgHelp.showModal());
          el.btnHelpClose.addEventListener('click', () => el.dlgHelp.close());
      }
      
      document.addEventListener('DOMContentLoaded', () => {
          setupElements();
          const savedTheme = localStorage.getItem(LS_THEME) || 'theme-dark';
          document.body.className = savedTheme;
          el.btnTheme.textContent = savedTheme === 'theme-dark' ? '‚òÄÔ∏è' : 'üåô';
          setupEventListeners();
          updateUI();
          showMsg("Entrez les longueurs connues pour commencer.");
      });
    })();
  </script>
</body>
</html>
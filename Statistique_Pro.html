<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="G√©n√©rateur de s√©rie statistique √† partir de contraintes (moyenne, m√©diane, √©tendue, effectif)" />
  <meta name="color-scheme" content="light dark" />
  <title>Statistique Pro | G√©n√©rateur de s√©rie statistique</title>
  <style>
    :root {
      --radius: 14px;
      --shadow: 0 10px 28px rgba(0,0,0,.18);
      --primary: #1976d2;
      --primary-dark: #1565c0;
      --transition: all 0.2s ease;
      --focus-glow: 0 0 0 3px rgba(25, 118, 210, 0.3);
    }
    body.theme-dark {
      --bg: #0f1115; --card: #161a22; --text: #e8ecf1; --muted: #9aa2af;
      --border: #232939; --input-bg: #0d1117; --placeholder: #5c6370;
      --accent: rgba(25,118,210,0.15);
    }
    body.theme-light {
      --bg: #f6f8fc; --card: #ffffff; --text: #10141a; --muted: #586171;
      --border: #e5e9f1; --input-bg: #fefefe; --placeholder: #8a94a6;
      --accent: rgba(25,118,210,0.08);
    }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.5; transition: var(--transition);
    }
    h1, h2, h3 { font-weight: 600; margin: 0; }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .topbar {
      position: sticky; top: 0; z-index: 3;
      background: var(--card); border-bottom: 1px solid var(--border);
      padding: 12px 16px; display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .icon-btn, .btn {
      border: 1px solid var(--border); background: transparent; color: var(--text);
      border-radius: 10px; font-weight: 500; touch-action: manipulation;
      transition: var(--transition); cursor: pointer;
    }
    .icon-btn { padding: 8px 10px; font-size: 16px; display: inline-flex; align-items: center; justify-content: center; }
    .btn { padding: 10px 16px; font-size: 14px; }
    .btn:hover, .icon-btn:hover { background: var(--accent); border-color: rgba(25,118,210,0.24); }
    .btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
    .btn[disabled] { opacity: 0.6; cursor: not-allowed; }

    .container { max-width: 900px; margin: 0 auto; padding: 16px; }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      padding: 16px; margin: 16px 0; animation: fadeIn 0.3s ease-out;
    }
    .card h2 { font-size: 18px; margin-bottom: 12px; }

    input[type="text"], input[type="number"], select {
      width: 100%; box-sizing: border-box; background: var(--input-bg); color: var(--text);
      border: 1px solid var(--border); border-radius: 8px;
      padding: 10px 12px; font-size: 14px; transition: var(--transition);
    }
    input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: var(--focus-glow); }
    input::placeholder { color: var(--placeholder); opacity: 1; }

    .input-grid { display: grid; gap: 14px; margin-top: 12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    
    .input-fields-container {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 14px; margin-top: 12px;
    }
    .input-fields-container .field {
      flex: 1 1 240px; max-width: 300px;
    }

    .field { display: flex; flex-direction: column; gap: 6px; }
    .small { color: var(--muted); font-size: 13px; }

    pre {
      white-space: pre-wrap; margin: 0; background: var(--input-bg);
      border: 1px solid var(--border); border-radius: 10px; padding: 14px;
      font: 13px/1.6 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    .series-container {
      display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; padding: 8px 0;
    }
    .stat-value {
      border: 1px solid var(--border); background-color: var(--input-bg);
      padding: 8px 14px; border-radius: 8px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      font-size: 14px; text-align: center; min-width: 60px;
    }
    .msg { margin-top: 8px; font-size: 13px; }
    .msg.error { color: #ff6b6b; }
    .msg.success { color: #4caf50; }
    .footer { text-align: center; margin: 20px 0; padding: 12px; color: var(--muted); font-size: 13px; }
    dialog {
      border: 1px solid var(--border); background: var(--card); color: var(--text);
      border-radius: var(--radius); padding: 16px; max-width: 720px;
      width: calc(100% - 32px); box-shadow: var(--shadow);
    }
    dialog::backdrop { background: rgba(0,0,0,0.4); }
    .dialog-actions { margin-top: 12px; display: flex; justify-content: flex-end; gap: 8px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    @keyframes dialog-show {
      from { opacity: 0; transform: scale(0.97) translateY(10px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    dialog[open] { animation: dialog-show 0.3s ease-out forwards; }

    @keyframes backdrop-fade-in {
      from { background: rgba(0, 0, 0, 0); }
      to { background: rgba(0, 0, 0, 0.4); }
    }
    dialog[open]::backdrop { animation: backdrop-fade-in 0.3s ease-out forwards; }

    .dropdown { position: relative; }
    .dropdown-summary { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 600; cursor: pointer; list-style: none; padding: 4px 8px; border-radius: 8px; transition: var(--transition); }
    .dropdown-summary:hover { background: var(--accent); }
    .dropdown-summary::-webkit-details-marker { display: none; }
    .dropdown-summary .arrow { transition: transform 0.2s ease; }
    details[open] > .dropdown-summary .arrow { transform: rotate(180deg); }
    .dropdown-menu { position: absolute; top: calc(100% + 8px); left: 0; z-index: 10; background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); width: 280px; padding: 8px; opacity: 0; transform: translateY(-10px); pointer-events: none; transition: opacity 0.2s ease, transform 0.2s ease; }
    details[open] > .dropdown-menu { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .dropdown-menu a { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; text-decoration: none; color: var(--text); font-size: 14px; font-weight: 500; }
    .dropdown-menu a:hover { background: var(--accent); }
    .dropdown-menu a.active { font-weight: 600; color: var(--primary); background: var(--accent); }
    .dropdown-menu .emoji { font-size: 18px; }
    .dropdown-menu hr { border: none; border-top: 1px solid var(--border); margin: 8px 0; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="theme-dark">
  <header class="topbar">
    <details class="dropdown">
      <summary class="dropdown-summary">
        <span class="emoji">üìä</span>
        <span>Statistique Pro</span>
        <svg class="arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M7 10l5 5 5-5H7z"></path></svg>
      </summary>
      <nav class="dropdown-menu">
        <a href="index.html"><span class="emoji">üî¢</span><span>Menu Principal</span></a>
        <hr>
        <a href="Pythagore_pro.html"><span class="emoji">üßÆ</span><span>Pythagore Pro</span></a>
        <a href="Thales_Pro.html"><span class="emoji">üìê</span><span>Thal√®s Pro</span></a>
        <a href="Developpement_Pro.html"><span class="emoji">‚öôÔ∏è</span><span>D√©veloppement Pro</span></a>
        <a href="Equation_Premier_Degre_Pro.html"><span class="emoji">‚öñÔ∏è</span><span>√âquation Pro (1er degr√©)</span></a>
        <a href="Statistique_Pro.html" class="active"><span class="emoji">üìä</span><span>Statistique Pro</span></a>
      </nav>
    </details>
    <div class="actions">
      <button id="btnTheme" class="icon-btn" title="Changer de th√®me">üåì</button>
      <button id="btnInfo" class="icon-btn" title="Aide">‚ÑπÔ∏è</button>
    </div>
  </header>

  <main class="container">
    <section class="card" aria-labelledby="section-calc">
      <h2 id="section-calc">Entrez les contraintes</h2>

      <div class="input-fields-container">
        <div class="field">
          <label for="inputEffectif">Effectif total</label>
          <input id="inputEffectif" type="text" inputmode="numeric" placeholder="ex: 5" value="" />
        </div>
        <div class="field">
          <label for="inputMoyenne">Moyenne</label>
          <input id="inputMoyenne" type="text" inputmode="decimal" placeholder="ex: 10" value="" />
        </div>
        <div class="field">
          <label for="inputMediane">M√©diane</label>
          <input id="inputMediane" type="text" inputmode="decimal" placeholder="ex: 10" value="" />
        </div>
        <div class="field">
          <label for="inputEtendue">√âtendue</label>
          <input id="inputEtendue" type="text" inputmode="decimal" placeholder="ex: 4" value="" />
        </div>
      </div>
       <div class="input-grid" style="margin-top: 20px;">
        <div class="field">
          <label for="precision">Pr√©cision (d√©cimales)</label>
          <select id="precision" aria-label="Nombre de d√©cimales">
            <option>0</option><option>1</option><option selected>2</option>
            <option>3</option><option>4</option>
          </select>
          <span class="small">Nombre de d√©cimales pour les valeurs g√©n√©r√©es.</span>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="actions">
        <button id="btnGenerate" class="btn primary">G√©n√©rer la s√©rie</button>
        <button id="btnClear" class="btn">Effacer</button>
      </div>
      <div id="msg" class="msg" role="status" aria-live="polite"></div>
    </section>

    <section id="resultCard" class="card" hidden>
      <h3 id="resultTitle">‚úÖ S√©rie g√©n√©r√©e</h3>
      <hr style="border:none;border-top:1px solid var(--border); margin: 8px 0;">
      <div id="resultSeries" class="series-container"></div>
      <pre id="resultVerification" style="margin-top: 16px;"></pre>
      <div class="actions" style="margin-top:10px; justify-content: center; gap: 8px;">
        <button id="btnCopyRedaction" class="btn">Copier la r√©daction</button>
        <button id="btnNew" class="btn">Nouveau</button>
        <button id="btnExportPDF" class="btn">Exporter en PDF</button>
      </div>
    </section>

    <footer class="footer">
      <p>¬´ Il y a trois sortes de mensonges : les mensonges, les sacr√©s mensonges et les statistiques. ¬ª</p>
    </footer>
  </main>

  <dialog id="dlgHelp">
    <h3>Aide ‚Ä¢ Statistique Pro</h3>
    <p>Cet outil g√©n√®re une s√©rie de nombres qui correspond aux contraintes statistiques que vous fournissez.</p>
    <ul>
      <li><strong>Effectif total :</strong> Le nombre de valeurs dans la s√©rie (doit √™tre un entier sup√©rieur √† 1).</li>
      <li><strong>Moyenne :</strong> La moyenne arithm√©tique de toutes les valeurs.</li>
      <li><strong>M√©diane :</strong> La valeur centrale de la s√©rie tri√©e.</li>
      <li><strong>√âtendue :</strong> La diff√©rence entre la plus grande et la plus petite valeur.</li>
    </ul>
    <p>Cliquez sur "G√©n√©rer la s√©rie" pour obtenir un exemple de s√©rie valide. Notez qu'il peut exister plusieurs solutions.</p>
    <div class="dialog-actions">
      <button id="btnHelpClose" class="btn">Fermer</button>
    </div>
  </dialog>

  <script>
    (function () {
      'use strict';
      
      const el = {};
      let state = { lastSeries: null };

      function setupElements() {
        const ids = ['inputEffectif', 'inputMoyenne', 'inputMediane', 'inputEtendue', 'precision', 'btnGenerate', 'btnClear', 'btnNew', 'btnCopyRedaction', 'btnExportPDF', 'resultCard', 'resultTitle', 'resultSeries', 'resultVerification', 'msg', 'btnTheme', 'btnInfo', 'dlgHelp', 'btnHelpClose'];
        ids.forEach(id => el[id] = document.getElementById(id));
      }

      function formatNumber(n, precision = 2) {
        if (!isFinite(n)) return '‚Äî';
        return n.toLocaleString('fr-FR', { minimumFractionDigits: precision, maximumFractionDigits: precision });
      }

      function parseInput(inputElement) {
        const val = inputElement.value.trim().replace(',', '.');
        if (val === '') return NaN;
        const num = parseFloat(val);
        return isFinite(num) ? num : NaN;
      }

      function showMsg(text, type = 'info') {
        el.msg.textContent = text || '';
        el.msg.className = `msg ${type}`;
      }

      function setTheme(theme) {
        document.body.className = theme;
        localStorage.setItem('stat_theme', theme);
        el.btnTheme.textContent = theme === 'theme-dark' ? '‚òÄÔ∏è' : 'üåô';
      }

      // --- FONCTION CORRIG√âE ---
      function generateSeries() {
        const n = parseInput(el.inputEffectif);
        const mean = parseInput(el.inputMoyenne);
        const median = parseInput(el.inputMediane);
        const range = parseInput(el.inputEtendue);
        
        if (!Number.isInteger(n) || n < 2) throw new Error("L'effectif total doit √™tre un entier sup√©rieur ou √©gal √† 2.");
        if (isNaN(mean) || isNaN(median) || isNaN(range)) throw new Error("Veuillez entrer des valeurs num√©riques valides pour toutes les contraintes.");
        if (range < 0) throw new Error("L'√©tendue ne peut pas √™tre n√©gative.");

        const sum = n * mean;
        let series = [];
        let min, max;

        if (n % 2 === 1) { // Effectif impair
            series.push(median);
            const remainingSum = sum - median;
            const countEachSide = (n - 1) / 2;
            
            if (countEachSide > 0) {
                // On r√©sout : (count * min) + (count * max) = remainingSum
                // Sachant que max = min + range
                // (count * min) + (count * (min + range)) = remainingSum
                // 2 * count * min + count * range = remainingSum
                min = (remainingSum - countEachSide * range) / (2 * countEachSide);
                max = min + range;

                for (let i = 0; i < countEachSide; i++) {
                    series.push(min);
                    series.push(max);
                }
            }
        } else { // Effectif pair
            series.push(median, median); // On place les deux valeurs centrales
            const remainingSum = sum - 2 * median;
            const countEachSide = (n - 2) / 2;

            if (countEachSide > 0) {
                min = (remainingSum - countEachSide * range) / (2 * countEachSide);
                max = min + range;
                 for (let i = 0; i < countEachSide; i++) {
                    series.push(min);
                    series.push(max);
                }
            } else { // Cas sp√©cial n=2
                min = (sum - range) / 2;
                max = min + range;
                series = [min, max]; // La s√©rie est juste [min, max]
            }
        }
        
        // V√©rification finale de coh√©rence
        if (min > median || max < median) {
            throw new Error("Contraintes incompatibles. La m√©diane est en dehors de la plage possible.");
        }
        if (!isFinite(min)) {
            throw new Error("Impossible de calculer une s√©rie avec ces contraintes. Essayez des valeurs diff√©rentes.");
        }

        series.sort((a, b) => a - b);
        return series;
      }

      function renderResults(series) {
        const precision = parseInt(el.precision.value, 10);
        el.resultSeries.innerHTML = series.map(val => `<span class="stat-value">${formatNumber(val, precision)}</span>`).join('');
        
        const sorted = [...series].sort((a,b) => a-b);
        const actualSum = sorted.reduce((a, b) => a + b, 0);
        const actualMean = actualSum / sorted.length;
        const getMedian = (arr) => arr.length % 2 ? arr[Math.floor(arr.length / 2)] : (arr[arr.length/2 - 1] + arr[arr.length/2]) / 2;
        const actualMedian = getMedian(sorted);
        const actualRange = sorted[sorted.length - 1] - sorted[0];
        
        el.resultVerification.textContent = [
          'V√©rification de la s√©rie g√©n√©r√©e :',
          `  Effectif: ${sorted.length}`,
          `  Moyenne : ${formatNumber(actualMean, precision + 2)}`,
          `  M√©diane : ${formatNumber(actualMedian, precision)}`,
          `  √âtendue : ${formatNumber(actualRange, precision)}`,
          `  Valeur min : ${formatNumber(sorted[0], precision)}`,
          `  Valeur max : ${formatNumber(sorted[sorted.length-1], precision)}`,
        ].join('\n');
        el.resultCard.hidden = false;
      }

      function onGenerateClick() {
        el.resultCard.hidden = true;
        try {
          const series = generateSeries();
          state.lastSeries = series;
          renderResults(series);
          showMsg('S√©rie g√©n√©r√©e avec succ√®s !', 'success');
        } catch(err) {
          state.lastSeries = null;
          showMsg(err.message, 'error');
        }
      }
      
      function onClearClick() {
        [el.inputEffectif, el.inputMoyenne, el.inputMediane, el.inputEtendue].forEach(input => input.value = '');
        el.resultCard.hidden = true;
        showMsg('Champs effac√©s.');
        el.inputEffectif.focus();
      }

      function setupEventListeners() {
        el.btnTheme.addEventListener('click', () => setTheme(document.body.classList.contains('theme-dark') ? 'theme-light' : 'theme-dark'));
        el.btnInfo.addEventListener('click', () => el.dlgHelp.showModal());
        el.btnHelpClose.addEventListener('click', () => el.dlgHelp.close());
        el.btnGenerate.addEventListener('click', onGenerateClick);
        el.btnClear.addEventListener('click', onClearClick);
        el.btnNew.addEventListener('click', onClearClick);
        
        el.btnCopyRedaction.addEventListener('click', () => {
          if (!state.lastSeries) { showMsg('Aucune s√©rie √† copier.', 'error'); return; }
          const precision = parseInt(el.precision.value, 10);
          const seriesText = 'S√©rie : ' + state.lastSeries.map(v => formatNumber(v, precision)).join(' ; ');
          const verificationText = el.resultVerification.textContent;
          const textToCopy = el.resultTitle.textContent + '\n\n' + seriesText + '\n\n' + verificationText;

          navigator.clipboard.writeText(textToCopy).then(
            () => showMsg('R√©daction copi√©e dans le presse-papiers.', 'success'),
            () => showMsg('Erreur lors de la copie.', 'error')
          );
        });

        el.btnExportPDF.addEventListener('click', () => {
            if (!state.lastSeries) { showMsg('Aucun r√©sultat √† exporter.', 'error'); return; }
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const precision = parseInt(el.precision.value, 10);

                doc.setFont('Helvetica', 'bold');
                doc.text(el.resultTitle.textContent, 10, 15);
                
                const seriesText = 'S√©rie : ' + state.lastSeries.map(v => formatNumber(v, precision)).join(' ; ');
                doc.setFont('Helvetica', 'normal');
                doc.text(seriesText, 10, 25);

                const verificationText = el.resultVerification.textContent;
                const splitContent = doc.splitTextToSize(verificationText, 180);
                doc.text(splitContent, 10, 35);

                doc.save('Statistique_Pro_Redaction.pdf');
                showMsg('Export PDF g√©n√©r√©.', 'success');
            } catch (e) {
                showMsg('Erreur lors de la g√©n√©ration du PDF.', 'error');
                console.error(e);
            }
        });

        document.querySelectorAll('.card input, .card select').forEach(input => {
            input.addEventListener('input', () => { el.resultCard.hidden = true; showMsg(''); });
            input.addEventListener('keypress', (e) => { if (e.key === 'Enter') onGenerateClick(); });
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        setupElements();
        setupEventListeners();
        const savedTheme = localStorage.getItem('stat_theme') || 'theme-dark';
        setTheme(savedTheme);
        showMsg('Entrez vos contraintes et cliquez sur "G√©n√©rer".');
      });
    })();
  </script>
</body>
</html>